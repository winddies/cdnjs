import*as tslib_1 from"tslib";import{Inject,Injectable}from"@angular/core";import{ReplaySubject}from"rxjs";import{filter}from"rxjs/operators";import{DefaultConfig}from"./angulartics2-config";import{ANGULARTICS2_TOKEN}from"./angulartics2-token";import{RouterlessTracking}from"./routerless";import*as i0 from"@angular/core";import*as i1 from"./routerless";import*as i2 from"./angulartics2-token";var Angulartics2=function(){function e(e,t){var r=this;this.tracker=e,this.pageTrack=new ReplaySubject(10),this.eventTrack=new ReplaySubject(10),this.exceptionTrack=new ReplaySubject(10),this.setAlias=new ReplaySubject(10),this.setUsername=new ReplaySubject(10),this.setUserProperties=new ReplaySubject(10),this.setUserPropertiesOnce=new ReplaySubject(10),this.setSuperProperties=new ReplaySubject(10),this.setSuperPropertiesOnce=new ReplaySubject(10),this.userTimings=new ReplaySubject(10);var i=new DefaultConfig;this.settings=tslib_1.__assign({},i,t.settings),this.settings.pageTracking=tslib_1.__assign({},i.pageTracking,t.settings.pageTracking),this.tracker.trackLocation(this.settings).subscribe(function(e){return r.trackUrlChange(e.url)})}return e.prototype.filterDeveloperMode=function(){var e=this;return filter(function(t,r){return!e.settings.developerMode})},e.prototype.trackUrlChange=function(e){if(this.settings.pageTracking.autoTrackVirtualPages&&!this.matchesExcludedRoute(e)){var t=this.clearUrl(e),r=void 0;r=this.settings.pageTracking.basePath.length?this.settings.pageTracking.basePath+t:this.tracker.prepareExternalUrl(t),this.pageTrack.next({path:r})}},e.prototype.matchesExcludedRoute=function(e){var t,r;try{for(var i=tslib_1.__values(this.settings.pageTracking.excludedRoutes),a=i.next();!a.done;a=i.next()){var s=a.value;if(s instanceof RegExp&&s.test(e)||-1!==e.indexOf(s))return!0}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!1},e.prototype.clearUrl=function(e){var t=this;return this.settings.pageTracking.clearIds||this.settings.pageTracking.clearQueryParams||this.settings.pageTracking.clearHash?e.split("/").map(function(e){return t.settings.pageTracking.clearQueryParams?e.split("?")[0]:e}).map(function(e){return t.settings.pageTracking.clearHash?e.split("#")[0]:e}).filter(function(e){return!t.settings.pageTracking.clearIds||!e.match(t.settings.pageTracking.idsRegExp)}).join("/"):e},e.ngInjectableDef=i0.defineInjectable({factory:function(){return new e(i0.inject(i1.RouterlessTracking),i0.inject(i2.ANGULARTICS2_TOKEN))},token:e,providedIn:"root"}),e=tslib_1.__decorate([Injectable({providedIn:"root"}),tslib_1.__param(1,Inject(ANGULARTICS2_TOKEN)),tslib_1.__metadata("design:paramtypes",[RouterlessTracking,Object])],e)}();export{Angulartics2};