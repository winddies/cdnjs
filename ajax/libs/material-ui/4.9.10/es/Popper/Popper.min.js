import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import*as React from"react";import PropTypes from"prop-types";import PopperJs from"popper.js";import{chainPropTypes,refType}from"@material-ui/utils";import{useTheme}from"@material-ui/styles";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import setRef from"../utils/setRef";import useForkRef from"../utils/useForkRef";import ownerWindow from"../utils/ownerWindow";function flipPlacement(e,t){if("ltr"===(t&&t.direction||"ltr"))return e;switch(e){case"bottom-end":return"bottom-start";case"bottom-start":return"bottom-end";case"top-end":return"top-start";case"top-start":return"top-end";default:return e}}function getAnchorEl(e){return"function"==typeof e?e():e}const useEnhancedEffect="undefined"!=typeof window?React.useLayoutEffect:React.useEffect,defaultPopperOptions={},Popper=React.forwardRef(function(e,t){const{anchorEl:o,children:n,container:r,disablePortal:p=!1,keepMounted:s=!1,modifiers:i,open:c,placement:a="bottom",popperOptions:l=defaultPopperOptions,popperRef:u,style:f,transition:d=!1}=e,m=_objectWithoutPropertiesLoose(e,["anchorEl","children","container","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","style","transition"]),h=React.useRef(null),y=useForkRef(h,t),E=React.useRef(null),P=useForkRef(E,u),b=React.useRef(P);useEnhancedEffect(()=>{b.current=P},[P]),React.useImperativeHandle(u,()=>E.current,[]);const[R,T]=React.useState(!0),w=flipPlacement(a,useTheme()),[O,g]=React.useState(w);React.useEffect(()=>{E.current&&E.current.update()});const j=React.useCallback(()=>{if(!h.current||!o||!c)return;E.current&&(E.current.destroy(),b.current(null));const e=e=>{g(e.placement)},t=getAnchorEl(o);if("production"!==process.env.NODE_ENV){if(t instanceof ownerWindow(t).Element){const e=t.getBoundingClientRect();"test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom&&console.warn(["Material-UI: the `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}}const n=new PopperJs(getAnchorEl(o),h.current,_extends({placement:w},l,{modifiers:_extends({},p?{}:{preventOverflow:{boundariesElement:"window"}},{},i,{},l.modifiers),onCreate:createChainedFunction(e,l.onCreate),onUpdate:createChainedFunction(e,l.onUpdate)}));b.current(n)},[o,p,i,c,w,l]),v=React.useCallback(e=>{setRef(y,e),j()},[y,j]),C=()=>{T(!1)},k=()=>{E.current&&(E.current.destroy(),b.current(null))},_=()=>{T(!0),k()};if(React.useEffect(()=>{j()},[j]),React.useEffect(()=>()=>{k()},[]),React.useEffect(()=>{c||d||k()},[c,d]),!s&&!c&&(!d||R))return null;const x={placement:O};return d&&(x.TransitionProps={in:c,onEnter:C,onExited:_}),React.createElement(Portal,{disablePortal:p,container:r},React.createElement("div",_extends({ref:v,role:"tooltip"},m,{style:_extends({position:"fixed",top:0,left:0},f)}),"function"==typeof n?n(x):n))});"production"!==process.env.NODE_ENV&&(Popper.propTypes={anchorEl:chainPropTypes(PropTypes.oneOfType([PropTypes.object,PropTypes.func]),e=>{if(e.open){const t=getAnchorEl(e.anchorEl);if(t instanceof ownerWindow(t).Element){const e=t.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom)return new Error(["Material-UI: the `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}else if(!t||"number"!=typeof t.clientWidth||"number"!=typeof t.clientHeight||"function"!=typeof t.getBoundingClientRect)return new Error(["Material-UI: the `anchorEl` prop provided to the component is invalid.","It should be an HTML Element instance or a referenceObject ","(https://popper.js.org/docs/v1/#referenceObject)."].join("\n"))}return null}),children:PropTypes.oneOfType([PropTypes.node,PropTypes.func]).isRequired,container:PropTypes.oneOfType([PropTypes.func,PropTypes.instanceOf(React.Component),PropTypes.instanceOf("undefined"==typeof Element?Object:Element)]),disablePortal:PropTypes.bool,keepMounted:PropTypes.bool,modifiers:PropTypes.object,open:PropTypes.bool.isRequired,placement:PropTypes.oneOf(["bottom-end","bottom-start","bottom","left-end","left-start","left","right-end","right-start","right","top-end","top-start","top"]),popperOptions:PropTypes.object,popperRef:refType,style:PropTypes.object,transition:PropTypes.bool});export default Popper;