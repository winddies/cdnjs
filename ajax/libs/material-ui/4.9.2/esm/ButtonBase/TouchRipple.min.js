import _extends from"@babel/runtime/helpers/esm/extends";import _toConsumableArray from"@babel/runtime/helpers/esm/toConsumableArray";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import React from"react";import PropTypes from"prop-types";import{TransitionGroup}from"react-transition-group";import clsx from"clsx";import withStyles from"../styles/withStyles";import Ripple from"./Ripple";var DURATION=550;export var DELAY_RIPPLE=80;export var styles=function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}};var TouchRipple=React.forwardRef(function(e,t){var r=e.center,n=void 0!==r&&r,i=e.classes,o=e.className,a=_objectWithoutProperties(e,["center","classes","className"]),c=React.useState([]),s=c[0],l=c[1],u=React.useRef(0),p=React.useRef(null);React.useEffect(function(){p.current&&(p.current(),p.current=null)},[s]);var m=React.useRef(!1),f=React.useRef(null),h=React.useRef(null),R=React.useRef(null);React.useEffect(function(){return function(){clearTimeout(f.current)}},[]);var d=React.useCallback(function(e){var t=e.pulsate,r=e.rippleX,n=e.rippleY,o=e.rippleSize,a=e.cb;l(function(e){return[].concat(_toConsumableArray(e),[React.createElement(Ripple,{key:u.current,classes:i,timeout:DURATION,pulsate:t,rippleX:r,rippleY:n,rippleSize:o})])}),u.current+=1,p.current=a},[i]),b=React.useCallback(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=t.pulsate,o=void 0!==i&&i,a=t.center,c=void 0===a?n||t.pulsate:a,s=t.fakeElement,l=void 0!==s&&s;if("mousedown"===e.type&&m.current)m.current=!1;else{"touchstart"===e.type&&(m.current=!0);var u,p,b,y=l?null:R.current,v=y?y.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(c||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)u=Math.round(v.width/2),p=Math.round(v.height/2);else{var g=e.clientX?e.clientX:e.touches[0].clientX,T=e.clientY?e.clientY:e.touches[0].clientY;u=Math.round(g-v.left),p=Math.round(T-v.top)}if(c)(b=Math.sqrt((2*Math.pow(v.width,2)+Math.pow(v.height,2))/3))%2==0&&(b+=1);else{var x=2*Math.max(Math.abs((y?y.clientWidth:0)-u),u)+2,M=2*Math.max(Math.abs((y?y.clientHeight:0)-p),p)+2;b=Math.sqrt(Math.pow(x,2)+Math.pow(M,2))}e.touches?null===h.current&&(h.current=function(){d({pulsate:o,rippleX:u,rippleY:p,rippleSize:b,cb:r})},f.current=setTimeout(function(){h.current&&(h.current(),h.current=null)},DELAY_RIPPLE)):d({pulsate:o,rippleX:u,rippleY:p,rippleSize:b,cb:r})}},[n,d]),y=React.useCallback(function(){b({},{pulsate:!0})},[b]),v=React.useCallback(function(e,t){if(clearTimeout(f.current),"touchend"===e.type&&h.current)return e.persist(),h.current(),h.current=null,void(f.current=setTimeout(function(){v(e,t)}));h.current=null,l(function(e){return e.length>0?e.slice(1):e}),p.current=t},[]);return React.useImperativeHandle(t,function(){return{pulsate:y,start:b,stop:v}},[y,b,v]),React.createElement("span",_extends({className:clsx(i.root,o),ref:R},a),React.createElement(TransitionGroup,{component:null,exit:!0},s))});"production"!==process.env.NODE_ENV&&(TouchRipple.propTypes={center:PropTypes.bool,classes:PropTypes.object.isRequired,className:PropTypes.string});export default withStyles(styles,{flip:!1,name:"MuiTouchRipple"})(React.memo(TouchRipple));