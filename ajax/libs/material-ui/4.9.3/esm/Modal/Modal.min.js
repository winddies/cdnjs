import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import React from"react";import ReactDOM from"react-dom";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"./TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return e="function"==typeof e?e():e,ReactDOM.findDOMNode(e)}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new ModalManager;export var styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}};var Modal=React.forwardRef(function(e,o){var r=useTheme(),n=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),t=n.BackdropComponent,a=void 0===t?SimpleBackdrop:t,i=n.BackdropProps,c=n.children,s=n.closeAfterTransition,p=void 0!==s&&s,l=n.container,d=n.disableAutoFocus,u=void 0!==d&&d,f=n.disableBackdropClick,m=void 0!==f&&f,b=n.disableEnforceFocus,y=void 0!==b&&b,k=n.disableEscapeKeyDown,T=void 0!==k&&k,P=n.disablePortal,R=void 0!==P&&P,E=n.disableRestoreFocus,h=void 0!==E&&E,v=n.disableScrollLock,C=void 0!==v&&v,F=n.hideBackdrop,g=void 0!==F&&F,x=n.keepMounted,M=void 0!==x&&x,B=n.manager,D=void 0===B?defaultManager:B,w=n.onBackdropClick,A=n.onClose,I=n.onEscapeKeyDown,K=n.onRendered,S=n.open,_=_objectWithoutProperties(n,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),j=React.useState(!0),z=j[0],O=j[1],H=React.useRef({}),L=React.useRef(null),N=React.useRef(null),W=useForkRef(N,o),q=getHasTransition(n),V=function(){return ownerDocument(L.current)},G=function(){return H.current.modalRef=N.current,H.current.mountNode=L.current,H.current},J=function(){D.mount(G(),{disableScrollLock:C}),N.current.scrollTop=0},Q=useEventCallback(function(){var e=getContainer(l)||V().body;D.add(G(),e),N.current&&J()}),U=React.useCallback(function(){return D.isTopModal(G())},[D]),X=useEventCallback(function(e){L.current=e,e&&(K&&K(),S&&U()?J():ariaHidden(N.current,!0))}),Y=React.useCallback(function(){D.remove(G())},[D]);if(React.useEffect(function(){return function(){Y()}},[Y]),React.useEffect(function(){S?Q():q&&p||Y()},[S,Y,q,p,Q]),!M&&!S&&(!q||z))return null;var Z=styles(r||{zIndex:zIndex}),$={};return void 0===c.props.tabIndex&&($.tabIndex=c.props.tabIndex||"-1"),q&&($.onEnter=createChainedFunction(function(){O(!1)},c.props.onEnter),$.onExited=createChainedFunction(function(){O(!0),p&&Y()},c.props.onExited)),React.createElement(Portal,{ref:X,container:l,disablePortal:R},React.createElement("div",_extends({ref:W,onKeyDown:function(e){"Escape"===e.key&&U()&&(e.stopPropagation(),I&&I(e),!T&&A&&A(e,"escapeKeyDown"))},role:"presentation"},_,{style:_extends({},Z.root,{},!S&&z?Z.hidden:{},{},_.style)}),g?null:React.createElement(a,_extends({open:S,onClick:function(e){e.target===e.currentTarget&&(w&&w(e),!m&&A&&A(e,"backdropClick"))}},i)),React.createElement(TrapFocus,{disableEnforceFocus:y,disableAutoFocus:u,disableRestoreFocus:h,getDoc:V,isEnabled:U,open:S},React.cloneElement(c,$))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([PropTypes.object,PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,manager:PropTypes.object,onBackdropClick:PropTypes.func,onClose:PropTypes.func,onEscapeKeyDown:PropTypes.func,onRendered:PropTypes.func,open:PropTypes.bool.isRequired});export default Modal;